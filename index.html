<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parameterized Tray - Pro Segment Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/STLExporter.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Patrick+Hand&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #1a1a1a; color: #f4f4f5; margin: 0; overflow: hidden; }
        .floating-panel { background: rgba(30, 30, 30, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); }
        .input-group { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.2s ease; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #ffffff; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(255,255,255,0.3); border: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: rgba(255,255,255,0.2); border-radius: 2px; }
        .view-label { position: absolute; top: 1rem; left: 1rem; background: rgba(255,255,255,0.1); padding: 6px 14px; border-radius: 10px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; color: rgba(255,255,255,0.8); z-index: 20; pointer-events: none; border: none; }
        #main-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .viewport-placeholder { position: relative; flex: 1; z-index: 2; }
        .dim-label { position: absolute; font-size: 11px; font-weight: 800; color: #ffffff; z-index: 2000; background: #27272a; padding: 4px 10px; border-radius: 6px; white-space: nowrap; box-shadow: 0 4px 12px rgba(0,0,0,0.8); cursor: pointer; pointer-events: auto; transition: transform 0.15s, background 0.2s; border: 1px solid rgba(255,255,255,0.2); user-select: none; }
        .dim-label:hover { background: #3b82f6; border-color: #ffffff; transform: scale(1.1); }
        .dim-input { width: 50px; background: #fff; color: #000; border: none; border-radius: 4px; font-size: 12px; font-weight: 800; text-align: center; outline: none; padding: 2px 0; }
        #add-indicator { position: fixed; width: 36px; height: 36px; background: #18181b; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 24px; pointer-events: none; z-index: 100; opacity: 0; transform: scale(0); transition: opacity 0.2s, transform 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        #add-indicator.active { opacity: 1; transform: scale(1); }
        #add-indicator.remove-confirm { background: #ef4444; color: white; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4); }
        #add-indicator.move { background: #3b82f6; color: white; font-size: 16px; }
        #preview-line { position: fixed; background: #3b82f6; pointer-events: none; z-index: 90; display: none; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        #global-dim-input { position: fixed; z-index: 9999; width: 60px; height: 26px; background: #fff; color: #000; border: 2px solid #3b82f6; border-radius: 6px; font-size: 11px; font-weight: 800; text-align: center; outline: none; padding: 0; display: none; box-shadow: 0 10px 25px rgba(0,0,0,0.5); transform: translate(-50%, -50%); font-family: 'Plus Jakarta Sans', sans-serif; }
        @media (max-width: 768px) { #global-dim-input { font-size: 16px !important; } }
        .dim-label-3d { background: rgba(24, 24, 27, 0.85); border: 1px solid rgba(255,255,255,0.3); color: #fff !important; backdrop-filter: blur(8px); box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .dim-label-3d input { color: #000 !important; }
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        /* Tutorial Overlay Styles */
        #tutorial-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 9999; display: none; }
        #tutorial-underlay { position: fixed; inset: 0; pointer-events: none; z-index: 5; display: none; }
        .tutorial-active #tutorial-overlay, .tutorial-active #tutorial-underlay { display: block; }

        .tutorial-skip-btn { position: fixed; bottom: 30px; right: 30px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.7); padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; pointer-events: auto; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.05em; z-index: 10003; }
        .tutorial-skip-btn:hover { background: rgba(255, 255, 255, 0.2); color: white; transform: scale(1.05); }

        .tutorial-blob { position: absolute; width: 100px; transition: all 0.5s ease-out; pointer-events: none; }
        .tutorial-blob svg path { fill: #fef08a; stroke: #fff; stroke-width: 3px; filter: drop-shadow(0 0 4px rgba(255,255,255,0.8)); }
        .tutorial-blob svg { width: 100%; height: auto; filter: drop-shadow(0px 8px 24px rgba(0,0,0,0.15)); }
        .tutorial-text { position: absolute; inset: 0; display: flex; align-items: flex-start; justify-content: center; text-align: center; padding: 10px 20px 0 20px; font-family: 'Patrick Hand', cursive; font-size: 12px; line-height: 1.3; color: #18181b; font-weight: 600; transform: rotate(-2deg); pointer-events: none; }

        .tutorial-arrow { position: absolute; width: 60px; height: 60px; transition: all 0.5s ease-out; z-index: 10000; }
        .tutorial-arrow svg { width: 100%; height: 100%; stroke: #fff; filter: drop-shadow(0 0 4px rgba(255,255,255,0.8)); }

        .ghost-cursor { position: absolute; width: 32px; height: 32px; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 10002; transform-origin: 0 0; }
        .ghost-cursor svg { filter: drop-shadow(0 0 5px #fff) drop-shadow(0 0 10px #fff); }

        .ghost-divider { position: absolute; background: rgba(59, 130, 246, 0.5); pointer-events: none; opacity: 0; z-index: 9998; border-radius: 2px; }
        .cursor-trail { position: absolute; width: 4px; background: rgba(59, 130, 246, 0.6); border-radius: 2px; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 9998; box-shadow: 0 0 8px rgba(59, 130, 246, 0.8); }

        @keyframes cursor-scan-h {
            0% { opacity: 0; transform: translate(0, -75px); }
            10% { opacity: 1; transform: translate(0, -75px); }
            50% { transform: translate(0, 75px); }
            90% { transform: translate(0, -75px); }
            100% { opacity: 0; transform: translate(0, -75px); }
        }
        @keyframes cursor-scan-v {
            0% { opacity: 0; transform: translate(0, 0); }
            10% { opacity: 1; transform: translate(0, 0); }
            50% { transform: translate(150px, 0); }
            90% { transform: translate(0, 0); }
            100% { opacity: 0; transform: translate(0, 0); }
        }
        @keyframes cursor-drag-shadow {
             0% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            20% { transform: translate(-50%, -50%) scale(0.9); }
            70% { transform: translate(50px, -50%) scale(0.9); }
            90% { transform: translate(50px, -50%) scale(1); }
            100% { opacity: 0; transform: translate(50px, -50%) scale(1); }
        }
        @keyframes divider-drag-shadow {
             0% { opacity: 0; transform: translate(-50%, -50%); }
            10% { opacity: 0; transform: translate(-50%, -50%); }
            20% { opacity: 1; transform: translate(-50%, -50%); }
            70% { transform: translate(50px, -50%); }
            90% { opacity: 0; transform: translate(50px, -50%); }
            100% { opacity: 0; transform: translate(50px, -50%); }
        }
        @keyframes cursor-click-delete-slow {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            30% { transform: translate(-50%, -50%) scale(0.8); }
            50% { transform: translate(-50%, -50%) scale(1); }
            60% { transform: translate(-50%, -50%) scale(1); }
            70% { transform: translate(-50%, -50%) scale(0.8); }
            90% { transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
    </style>
</head>
<body class="relative h-screen w-screen">
    <canvas id="main-canvas"></canvas>

    <button id="tut-skip" class="tutorial-skip-btn">Skip Tutorial</button>
    <div id="tutorial-underlay">
        <div id="tut-blob" class="tutorial-blob">
            <svg viewBox="0 0 200 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.5 45.5C8.5 65.5 -5.5 105.5 22.5 125.5C50.5 145.5 100.5 155.5 145.5 135.5C190.5 115.5 205.5 65.5 185.5 35.5C165.5 5.5 100.5 -15.5 55.5 15.5C35.5 28.5 22.5 45.5 22.5 45.5Z" fill="#FFD700"/>
            </svg>
            <div id="tut-text" class="tutorial-text">Start here!</div>
        </div>
    </div>
    <div id="tutorial-overlay">
        <div id="tut-arrow" class="tutorial-arrow">
            <svg viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10 90 Q 50 50 80 20 M 80 20 L 50 20 M 80 20 L 80 50" />
            </svg>
        </div>
        <div id="ghost-cursor" class="ghost-cursor">
            <svg viewBox="0 0 24 24" fill="white" stroke="black" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 3L10.07 19.97L12.58 12.58L19.97 10.07L3 3Z" />
            </svg>
        </div>
        <div id="ghost-divider" class="ghost-divider"></div>
        <div id="cursor-trail" class="cursor-trail"></div>
    </div>

    <input type="number" id="global-dim-input" aria-label="Global Dimension Editor" />
    <div class="absolute inset-0 z-10 flex flex-col pointer-events-none">
        <header class="w-full p-4 md:p-6 flex justify-between items-center pointer-events-none">
            <div class="flex items-center gap-3 pointer-events-auto">
                <div class="w-10 h-10 bg-white rounded-2xl flex items-center justify-center shadow-xl"><div class="w-5 h-5 bg-black rotate-45 rounded-sm"></div></div>
                <div><h1 class="font-bold text-lg leading-none text-white">Parameterized Tray</h1><p class="text-[10px] text-zinc-400 font-medium uppercase tracking-widest mt-1">Smart Editing Mode</p></div>
            </div>
            <div class="flex gap-3 pointer-events-auto">
                <button id="export-btn" class="bg-white text-black font-bold px-4 py-2 md:px-6 md:py-3 rounded-2xl text-xs md:text-sm flex items-center gap-2 hover:scale-105 active:scale-95 transition-all shadow-lg hover:bg-zinc-200"><i data-lucide="download" class="w-4 h-4"></i><span class="hidden md:inline">Export STL</span><span class="md:hidden">Export</span></button>
            </div>
        </header>

        <div class="px-4 pb-2 md:hidden pointer-events-auto w-full flex justify-center">
            <div class="bg-zinc-800/80 backdrop-blur-md p-1 rounded-xl flex gap-1 border border-white/10 shadow-lg">
                <button id="tab-3d" class="px-6 py-2 rounded-lg text-xs font-bold transition-all bg-zinc-600 text-white shadow-sm">3D View</button>
                <button id="tab-top" class="px-6 py-2 rounded-lg text-xs font-bold transition-all text-zinc-400 hover:text-white">Top View</button>
            </div>
        </div>

        <main id="viewports-container" class="flex-1 flex flex-col md:flex-row relative">
            <div id="view-3d-placeholder" class="viewport-placeholder border-b md:border-b-0 md:border-r border-white/10 pointer-events-auto cursor-grab active:cursor-grabbing flex-1"><div class="view-label md:block hidden">3D View</div><div id="dim-container-3d" class="absolute inset-0 pointer-events-none overflow-hidden" style="z-index: 50;"></div></div>
            <div id="view-top-placeholder" class="viewport-placeholder pointer-events-auto hidden md:block md:flex-1"><div class="view-label md:block hidden">Top View</div><div id="dim-container" class="absolute inset-0 pointer-events-none overflow-hidden" style="z-index: 50;"></div></div>
        </main>
        <div class="w-full p-4 md:p-8 flex justify-center pointer-events-none">
            <div class="floating-panel rounded-[2.5rem] p-4 md:p-8 flex flex-col md:flex-row gap-8 items-center justify-between pointer-events-auto w-full max-w-4xl">
                <div class="flex gap-4 items-center">
                    <div class="flex flex-col gap-1"><span class="text-[10px] text-zinc-400 font-bold uppercase tracking-wider ml-1">Dimensions (mm)</span><div class="flex gap-2"><div class="input-group px-3 py-2 rounded-xl flex items-center gap-2"><label for="dim-l" class="text-[10px] text-zinc-400 font-bold cursor-pointer" title="Length">L</label><input type="number" id="dim-l" aria-label="Length" value="120" class="w-12 bg-transparent text-sm font-semibold outline-none text-center text-white"></div><div class="input-group px-3 py-2 rounded-xl flex items-center gap-2"><label for="dim-w" class="text-[10px] text-zinc-400 font-bold cursor-pointer" title="Width">W</label><input type="number" id="dim-w" aria-label="Width" value="120" class="w-12 bg-transparent text-sm font-semibold outline-none text-center text-white"></div><div class="input-group px-3 py-2 rounded-xl flex items-center gap-2"><label for="dim-h" class="text-[10px] text-zinc-400 font-bold cursor-pointer" title="Height">H</label><input type="number" id="dim-h" aria-label="Height" value="40" class="w-12 bg-transparent text-sm font-semibold outline-none text-center text-white"></div></div></div>
                </div>
                <div class="w-px h-10 bg-white/10 mx-2"></div>
                <div class="flex flex-col gap-1 w-32"><div class="flex justify-between items-center mb-1"><label for="radius" class="text-[10px] text-zinc-400 font-bold uppercase tracking-wider cursor-pointer">Corner Radius</label><span id="radius-val" class="text-[10px] text-white font-bold">8mm</span></div><input type="range" id="radius" aria-label="Corner Radius" min="2" max="30" value="8" step="1"></div>
                <div class="w-px h-10 bg-white/10 mx-2"></div>
                <div class="flex flex-col gap-1 flex-1"><div class="flex justify-between items-center mb-1"><span class="text-[10px] text-zinc-400 font-bold uppercase tracking-wider ml-1">Dividers</span><button id="clear-dividers" class="text-[9px] text-red-400 hover:text-red-300 uppercase font-bold tracking-tighter">Clear All</button></div><div class="text-xs text-zinc-400 font-medium" id="divider-stats">Vert: 0 | Horiz: 0</div></div>
            </div>
        </div>
    </div>
    <script type="module" src="./src/main.js"></script>
</body>
</html>
